# Bookstore 接口文档

## 目录
- [通用说明](#通用说明)
- [用户模块](#用户模块)
- [图书模块](#图书模块)
- [购物车模块](#购物车模块)
- [管理模块](#管理模块)
- [会话模块](#会话模块)

---

## 通用说明

### 基础信息
- **基础URL**: `http://localhost:8080`
- **数据格式**: JSON
- **字符编码**: UTF-8

### 响应格式
所有接口统一返回以下格式：

```json
{
  "code": 200,      
  "message": "success",  
  "data": {}     
}
```

**响应码说明**：
- `200`: 操作成功
- `0`: 操作失败

### 分页响应格式
```json
{
  "code": 200,      
  "message": "success",  
  "data": {
    "curPage": 1,    
    "pageSize": 10,     
    "totalCount": 100,      
    "totalPage": 10,       
    "pageData": []
  }     
}

```

### 认证说明
- 部分接口需要在请求头中携带JWT Token进行身份验证
- Token通过登录接口获取
- 需要在请求头中添加：`token: {token}`

---

## 用户模块

### 1. 用户注册

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/users/register` |
| 请求方式 | `POST` |
| 是否需要认证 | 否 |

**请求体**
```json
{
  "username": "newuser",
  "password": "123456"
}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 2. 用户登录

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/users/login` |
| 请求方式 | `POST` |
| 是否需要认证 | 否 |

**请求体**
```json
{
  "type": "username",
  "username": "testuser",
  "password": "123456"
}
```

**说明**：
- `type` 支持：`username`（用户名登录）、`uid`（用户ID登录）、`phone`（手机号登录，功能维护中）
- 用户名登录：需要 `type: "username"`、`username`、`password`
- 用户ID登录：需要 `type: "uid"`、`uid`、`password`
- 手机号登录：需要 `type: "phone"`、`phone`、`password`（功能维护中）

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### 3. 获取用户信息

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/users/{uid}` |
| 请求方式 | `GET` |
| 是否需要认证 | 否 |

**路径参数**
- `uid`: 用户ID

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "uid": 10001,
    "username": "testuser",
    "password": "******",
    "status": 1,
    "role": 1
  }
}
```

### 4. 获取用户地址信息

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/users/addr` |
| 请求方式 | `GET` |
| 是否需要认证 | 是 |

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "uid": 10001,
    "name": "张三",
    "phone": 13800138000,
    "address": "北京市朝阳区"
  }
}
```

### 5. 更新用户地址信息

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/users/addr` |
| 请求方式 | `PUT` |
| 是否需要认证 | 是 |

**请求体**
```json
{
  "uid": 10001,
  "name": "张三",
  "phone": 13800138000,
  "address": "北京市朝阳区"
}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 6. 修改密码/用户名

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/users/auth` |
| 请求方式 | `PUT` |
| 是否需要认证 | 是 |

**请求参数**
- `type`: 修改类型（`password` 或 `username`，必填）

**请求体**
```json
"newpassword123"
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 7. 购买图书

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/users/buy` |
| 请求方式 | `GET` |
| 是否需要认证 | 是 |

**查询参数**
- `bid`: 图书ID（必填）
- `number`: 购买数量（必填）

**请求示例**
```bash
GET /api/users/buy?bid=10001&number=2
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

---

## 图书模块

### 1. 获取图书列表

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/books/list` |
| 请求方式 | `GET` |
| 是否需要认证 | 否 |

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "bid": 10001,
      "isbn" : "9787111128063",
      "title": "Java编程思想",
      "author": "Bruce Eckel",
      "description": "Java编程经典教材",
      "publish": "机械工业出版社",
      "coverUrl": "/images/book1.jpg",
      "tags": "Java,编程",
      "rating": 95,
      "price": 89.00,
      "stock": 100,
      "sales": 500
    }
  ]
}
```

### 2. 分页查询图书

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/books` |
| 请求方式 | `GET` |
| 是否需要认证 | 否 |

**查询参数**
- `page`: 页码（可选，默认1）
- `size`: 每页大小（可选，默认20）

**请求示例**
```bash
GET /api/books?page=1&size=20
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "curPage": 1,
    "pageSize": 20,
    "totalCount": 100,
    "totalPage": 5,
    "pageData": [
      {
        "bid": 10001,
        "isbn" : "9787111128063",
        "title": "Java编程思想",
        "author": "Bruce Eckel",
        "description": "Java编程经典教材",
        "publish": "机械工业出版社",
        "coverUrl": "/images/book1.jpg",
        "tags": "Java,编程",
        "rating": 95,
        "price": 89.00,
        "stock": 100,
        "sales": 500
      }
    ]
  }
}
```

### 3. 搜索图书

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/books/search` |
| 请求方式 | `GET` |
| 是否需要认证 | 否 |

**查询参数**
- `page`: 页码（可选，不传则返回所有结果）
- `size`: 每页大小（可选，不传则返回所有结果）
- `title`: 图书标题（可选）
- `author`: 作者名称（可选）
- `tags`: 标签（可选）
- `isStock`: 是否仅看有库存（可选，默认false）

**请求示例**

不分页查询：
```bash
GET /api/books/search?title=Java&author=Bruce
```

分页查询：
```bash
GET /api/books/search?page=1&size=10&title=Java&isStock=true
```

**响应示例**

分页响应：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "curPage": 1,
    "pageSize": 10,
    "totalCount": 30,
    "totalPage": 3,
    "pageData": [
      {
        "bid": 10001,
        "isbn" : "9787111128063",
        "title": "Java编程思想",
        "author": "Bruce Eckel",
        "description": "Java编程经典教材",
        "publish": "机械工业出版社",
        "coverUrl": "/images/book1.jpg",
        "tags": "Java,编程",
        "rating": 95,
        "price": 89.00,
        "stock": 100,
        "sales": 500
      }
    ]
  }
}
```

不分页响应（直接返回数组）：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "bid": 10001,
      "isbn" : "9787111128063",
      "title": "Java编程思想",
      "author": "Bruce Eckel",
      "description": "Java编程经典教材",
      "publish": "机械工业出版社",
      "coverUrl": "/images/book1.jpg",
      "tags": "Java,编程",
      "rating": 95,
      "price": 89.00,
      "stock": 100,
      "sales": 500
    }
  ]
}
```

### 4. 获取图书详情

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/books/{bid}` |
| 请求方式 | `GET` |
| 是否需要认证 | 否 |

**路径参数**
- `bid`: 图书ID

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "bid": 10001,
    "isbn" : "9787111128063",
    "title": "Java编程思想",
    "author": "Bruce Eckel",
    "description": "Java编程经典教材",
    "publish": "机械工业出版社",
    "coverUrl": "/images/book1.jpg",
    "tags": "Java,编程",
    "rating": 95,
    "price": 89.00,
    "stock": 100,
    "sales": 500
  }
}
```

### 5. AI推荐图书

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/books/recommend/ai` |
| 请求方式 | `POST` |
| 是否需要认证 | 否 |

**请求体**
```json
"我想看一些和 Java 相关的入门书籍"
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data":"xxxxxx(ai的回复)"
}
```

---

## 购物车模块

### 1. 获取购物车

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/carts` |
| 请求方式 | `GET` |
| 是否需要认证 | 是 |

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "10001": 2,
    "10002": 1,
    "10003": 3
  }
}
```

**说明**：返回的数据为键值对，键为图书ID（bid），值为该图书在购物车中的数量。

### 2. 更新购物车

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/carts` |
| 请求方式 | `PUT` |
| 是否需要认证 | 是 |

**查询参数**
- `bid`: 图书ID（必填）
- `number`: 图书数量（必填）

**请求示例**
```bash
PUT /api/carts?bid=10001&number=3
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 3. 购物车结算

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/carts/checkout` |
| 请求方式 | `POST` |
| 是否需要认证 | 是 |

**说明**：对当前登录用户的购物车进行结算操作。

**响应示例（成功）**
```json
{
  "code": 200,
  "message": "success",
  "data": "结算成功"
}
```

**响应示例（失败）**
```json
{
  "code": 0,
  "message": "结算失败: 失败原因",
  "data": null
}
```

### 4. 删除购物车中的图书

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/carts/{bid}` |
| 请求方式 | `DELETE` |
| 是否需要认证 | 是 |

**路径参数**
- `bid`: 图书ID

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 5. 清空购物车

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/carts/clear` |
| 请求方式 | `DELETE` |
| 是否需要认证 | 是 |

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

---

## 管理模块

### 1. 创建用户

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/user` |
| 请求方式 | `POST` |
| 是否需要认证 | 是（管理员权限） |

**请求体**
```json
{
  "username": "newuser",
  "password": "123456",
  "status": 1,
  "role": 1
}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 2. 删除用户

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/user/{uid}` |
| 请求方式 | `DELETE` |
| 是否需要认证 | 是（管理员权限） |

**路径参数**
- `uid`: 用户ID

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "用户删除成功"
}
```

### 3. 获取用户列表

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/users/list` |
| 请求方式 | `GET` |
| 是否需要认证 | 是（管理员权限） |

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "uid": 10001,
      "username": "admin",
      "password": "******",
      "status": 1,
      "role": 0
    }
  ]
}
```

### 4. 分页查询用户

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/users` |
| 请求方式 | `GET` |
| 是否需要认证 | 是（管理员权限） |

**查询参数**
- `page`: 页码（可选，默认1）
- `size`: 每页大小（可选，默认10）

**请求示例**
```bash
GET /api/admin/users?page=1&size=20
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "curPage": 1,
    "pageSize": 20,
    "totalCount": 100,
    "totalPage": 5,
    "pageData": [
      {
        "id": 1,
        "uid": 10001,
        "username": "admin",
        "password": "******",
        "status": 1,
        "role": 0
      }
    ]
  }
}
```

### 5. 添加图书

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/book` |
| 请求方式 | `POST` |
| 是否需要认证 | 是（管理员权限） |

**请求体**
```json
{
  "isbn" : "9787111128063",
  "title": "Java编程思想",
  "author": "Bruce Eckel",
  "description": "Java编程经典教材",
  "publish": "机械工业出版社",
  "coverUrl": "/images/book1.jpg",
  "tags": "Java,编程",
  "price": 89.00
}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "图书添加成功"
}
```

### 6. 更新图书信息

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/book/{bid}` |
| 请求方式 | `PUT` |
| 是否需要认证 | 是（管理员权限） |

**路径参数**
- `bid`: 图书ID

**请求体**
```json
{
  "title": "Java编程思想（第5版）",
  "author": "Bruce Eckel",
  "description": "更新后的描述",
  "publish": "机械工业出版社",
  "coverUrl": "/images/book1.jpg",
  "tags": "Java,编程",
  "price": 99.00
}
```

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "图书更新成功"
}
```

### 7. 删除图书

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/book/{bid}` |
| 请求方式 | `DELETE` |
| 是否需要认证 | 是（管理员权限） |

**路径参数**
- `bid`: 图书ID

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "图书删除成功"
}
```

### 8. 更新图书库存

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/stock/{bid}` |
| 请求方式 | `PUT` |
| 是否需要认证 | 是（管理员权限） |

**路径参数**
- `bid`: 图书ID

**查询参数**
- `stock`: 新库存数量（必填）

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "图书库存更新成功"
}
```

### 9. 封禁用户

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/ban/{uid}` |
| 请求方式 | `GET` |
| 是否需要认证 | 是（管理员权限） |

**路径参数**
- `uid`: 用户ID

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "用户封禁成功"
}
```

### 10. 解封用户

| 字段 | 描述 |
|---|---|
| 接口路径 | `/api/admin/unban/{uid}` |
| 请求方式 | `GET` |
| 是否需要认证 | 是（管理员权限） |

**路径参数**
- `uid`: 用户ID

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": "用户解封成功"
}
```

---

## 会话模块

### 1. 设置Cookie

| 字段 | 描述 |
|---|---|
| 接口路径 | `/setCookie` |
| 请求方式 | `GET` |
| 是否需要认证 | 否 |

**说明**：此接口会在响应中设置名为`sessionId`的Cookie，值为`123456789`，主要用于测试Cookie功能。

**响应示例**
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 2. 获取Cookie

| 字段 | 描述 |
|---|---|
| 接口路径 | `/getCookie` |
| 请求方式 | `GET` |
| 是否需要认证 | 否 |

**请求头**
```
Cookie: sessionId=123456789
```

**响应示例**

成功响应：
```json
{
  "code": 200,
  "message": "success",
  "data": "Session ID: 123456789"
}
```

失败响应：
```json
{
  "code": 0,
  "message": "No session ID found",
  "data": null
}
```

---

## 注意事项

1. 所有需要认证的接口均需要在请求头中携带JWT Token
2. 管理员接口需要管理员权限（role=9）
3. 对于分页接口，如果不传递分页参数，部分接口会返回所有结果
4. 删除操作不可恢复，请谨慎使用
5. 购物车相关操作会自动识别当前登录用户（通过JWT Token）
6. 购买图书时会自动扣除库存并更新销量
7. 登录接口支持多种登录方式，根据`type`字段选择对应的登录方式
